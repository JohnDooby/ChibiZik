import{c as te}from"./chunk-FO3KTUAQ.js";import{b as ie}from"./chunk-XXI3354M.js";import{$a as j,Bb as ee,Ca as c,Ga as M,La as d,Ma as a,Na as s,O as T,Oa as g,Pa as h,Qa as b,Ra as C,S as H,Sa as k,Ta as Q,Ua as u,Va as _,Wa as y,Xa as J,Y as P,Ya as G,Z as O,Za as K,_a as x,ab as p,cb as q,hb as W,ma as X,pa as F,qa as l,ua as $,vb as N,wb as Z,xb as D,ya as m}from"./chunk-BEIZJTIJ.js";var f=class n{constructor(e){this.strudelService=e}chibisOnScene=[];draggedChibi;isPlaying=!1;chibiPositions=new Map;addChibi(e){this.chibisOnScene.includes(e)||(e.delay=Math.random()*-.5,this.chibisOnScene.push(e),this.isPlaying&&this.playChibis())}removeChibi(e){this.chibisOnScene=this.chibisOnScene.filter(t=>t.id!=e.id),this.isPlaying&&this.playChibis()}clearScene(){this.chibisOnScene=[],this.strudelService.stop(),this.isPlaying=!1}startScene(){this.strudelService.initialized||this.strudelService.initialize(),this.isPlaying=!0,this.playChibis()}pauseScene(){this.isPlaying=!1,this.strudelService.stop()}getCombinedCode(){if(this.chibisOnScene.length===0)return"";let e=this.chibisOnScene.filter(t=>!t.isMuted).map(t=>t.code);return console.log("Combined codes:",e),`stack(${e.join(",")})`}setChibiPosition(e,t,i){this.chibiPositions.set(e.id,{x:t,y:i})}getChibiPosition(e){return this.chibiPositions.get(e.id)||{x:0,y:0}}muteChibi(e){e.isMuted=!0,this.playChibis()}unmuteChibi(e){e.isMuted=!1,this.playChibis()}playChibis(){let e=this.getCombinedCode();console.log("Playing combined code:",e),e&&this.strudelService.play(e)}static \u0275fac=function(t){return new(t||n)(H(ie))};static \u0275prov=T({token:n,factory:n.\u0275fac,providedIn:"root"})};function le(n,e){if(n&1){let t=k();a(0,"div",5),u("click",function(o){P(t);let r=y();return O(r.muteChibi(o))}),p(1," \u{1F507} "),s()}}function me(n,e){if(n&1){let t=k();a(0,"div",6),u("click",function(o){P(t);let r=y();return O(r.unmuteChibi(o))}),p(1," \u{1F50A} "),s()}}var R=class n{constructor(e){this.sceneService=e}chibi=null;onDragStart(e,t){let i=e.target,o=i.cloneNode(!0),r=i.getBoundingClientRect(),S=e.clientX-r.left,E=e.clientY-r.top;e.dataTransfer?.setData("text/plain",t.id),e.dataTransfer?.setData("application/json",JSON.stringify({offsetX:S,offsetY:E})),o.style.width=`${r.width}px`,o.style.height=`${r.height}px`,o.style.position="fixed",o.style.top="-1000px",o.style.left="-1000px",o.style.zIndex="1000",o.style.opacity="1",o.style.pointerEvents="none",document.body.appendChild(o),e.dataTransfer?.setDragImage(o,S,E),setTimeout(()=>{document.body.removeChild(o)},0),console.log("Drag started (MOVE) for chibi:",t)}removeChibi(e){e.stopPropagation(),this.sceneService.removeChibi(this.chibi)}muteChibi(e){this.sceneService.muteChibi(this.chibi)}unmuteChibi(e){this.sceneService.unmuteChibi(this.chibi)}static \u0275fac=function(t){return new(t||n)(m(f))};static \u0275cmp=c({type:n,selectors:[["scene-chibi-item"]],inputs:{chibi:"chibi"},decls:6,vars:10,consts:[["draggable","true",1,"scene-chibi","shake-element",3,"dragstart"],["title","Retirer le chibi",1,"remove-btn",3,"click"],["class","mute-btn","title","Faire taire le chibi",3,"click",4,"ngIf"],["class","mute-btn","title","Faire jouer le chibi",3,"click",4,"ngIf"],[1,"chibi-img",3,"src"],["title","Faire taire le chibi",1,"mute-btn",3,"click"],["title","Faire jouer le chibi",1,"mute-btn",3,"click"]],template:function(t,i){t&1&&(a(0,"div",0),u("dragstart",function(r){return i.onDragStart(r,i.chibi)}),a(1,"div",1),u("click",function(r){return i.removeChibi(r)}),p(2," \u2716 "),s(),M(3,le,2,0,"div",2)(4,me,2,0,"div",3),g(5,"img",4),s()),t&2&&(x("animation-delay",i.chibi.delay+"s"),j("is-playing",i.sceneService.isPlaying)("is-muted",i.chibi.isMuted),l(3),d("ngIf",!i.chibi.isMuted),l(),d("ngIf",i.chibi.isMuted),l(),d("src",W(i.chibi==null?null:i.chibi.imageUrl),F))},dependencies:[D,Z],styles:['@charset "UTF-8";.scene-chibi[_ngcontent-%COMP%]{position:absolute;width:8%;height:auto;font-size:4rem;cursor:grab;display:flex;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_chibi-bounce 1s ease-in-out infinite;animation-play-state:paused}.scene-chibi[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%], .scene-chibi[_ngcontent-%COMP%]   .mute-btn[_ngcontent-%COMP%]{position:absolute;width:22px;height:22px;border-radius:50%;background:#000c;color:#fff;font-size:12px;line-height:22px;text-align:center;cursor:pointer;border:1px solid rgba(255,255,255,.2);opacity:0;pointer-events:none;transition:all .15s ease}.scene-chibi[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]:hover, .scene-chibi[_ngcontent-%COMP%]   .mute-btn[_ngcontent-%COMP%]:hover{transform:scale(1.2);background:#000}.scene-chibi[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]{top:-8px;right:-8px;color:#ff4d4d}.scene-chibi[_ngcontent-%COMP%]   .mute-btn[_ngcontent-%COMP%]{top:20px;right:-8px;font-size:14px}.scene-chibi[_ngcontent-%COMP%]:hover   .remove-btn[_ngcontent-%COMP%], .scene-chibi[_ngcontent-%COMP%]:hover   .mute-btn[_ngcontent-%COMP%]{opacity:1;pointer-events:auto}@media (hover: none){.scene-chibi[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%], .scene-chibi[_ngcontent-%COMP%]   .mute-btn[_ngcontent-%COMP%]{opacity:1;pointer-events:auto}}.chibi-img[_ngcontent-%COMP%]{padding:0;margin:0;width:15vw!important;height:15vh!important;object-fit:contain}@keyframes _ngcontent-%COMP%_chibi-bounce{0%,to{transform:translateY(0)}50%{transform:translateY(-20px)}}.scene-chibi.is-playing[_ngcontent-%COMP%]{animation-play-state:running}.scene-chibi.is-muted[_ngcontent-%COMP%]{animation-play-state:paused!important;filter:grayscale(100%) brightness(.8)}']})};var oe=[{id:"s1",slug:"Akane",nom:"Akane",emoji:"\u{1F9B6}",couleur:"#FF0000",code:'s("bd:0 ~ bd:0 [bd:0 bd:0]")',category:"kick",imageUrl:"assets/images/chibis/tambour.png"},{id:"s2",slug:"Chika",nom:"Chika",emoji:"\u{1F4A5}",couleur:"#FFD700",code:'s("[~ hh:0] [~ hh:0] [~ hh:0] ~")',category:"hat",imageUrl:"assets/images/chibis/highhat.png"},{id:"s3",slug:"Riku",nom:"Riku",emoji:"\u{1F40D}",couleur:"#32CD32",code:'s("~ sn:1 ~ [~ ~ ho:1 ~ ]")',category:"snare",imageUrl:"assets/images/chibis/snare.png"},{id:"s4",slug:"Kira",nom:"Kira",emoji:"\u{1F9E8}",couleur:"#FF4500",code:'s("~ ~ ~ [~ cr:5]")',category:"perc",imageUrl:"assets/images/chibis/cymballe.png"},{id:"s5",slug:"Sumire",nom:"Sumire",emoji:"\u{1F32B}\uFE0F",couleur:"#4B0082",code:'note("<[0 ~ ~ ~] [0 ~ [~ 4] [~ 7]] 8*4 5*4>").scale("D:minor").sound("arpy:0").lpf(200).release(0.1)',category:"bass",imageUrl:"assets/images/chibis/basse.png"},{id:"s6",slug:"Nana",nom:"Nana",emoji:"\u{1F3B8}",couleur:"#1E90FF",code:'note("<[e1 c1 ~ ~ e1 e1 ~ ~] [e1 c1 ~ ~ e1 g1 ~ ~] [a1 e1 ~ ~ a1 a1 ~ ~] [f1 a1 ~ ~ f1 a1 ~ ~]>").scale("D:minor").sound("arpy:0").sustain(2).decay(10).delay(".05").room(0.5)',category:"guitare",imageUrl:"assets/images/chibis/guitare.png"},{id:"s7",slug:"Rei",nom:"Rei",emoji:"\u2728",couleur:"#FF00FF",code:'note("[~ ~ g4 b4 ~ a4 g4 ~ ~ e4 g4 ~ b4 a4 g4 e4]/4").sound("arpy:0").clip(0.3).room(1).gain("0.7 0.9 0.6 0.8")',category:"lead",imageUrl:"assets/images/chibis/clavier.png"}];var w=class n{getChibis(){return oe}static \u0275fac=function(t){return new(t||n)};static \u0275prov=T({token:n,factory:n.\u0275fac,providedIn:"root"})};function pe(n,e){if(n&1&&g(0,"scene-chibi-item",2),n&2){let t=e.$implicit,i=y();x("left",i.sceneService.getChibiPosition(t).x,"px")("top",i.sceneService.getChibiPosition(t).y,"px"),d("chibi",t)}}var z=class n{constructor(e,t){this.sceneService=e;this.catalogService=t}chibis=[];ngOnInit(){}onDragOver(e){e.preventDefault()}onDrop(e){e.preventDefault();let t=e.dataTransfer?.getData("text/plain"),i=e.dataTransfer?.getData("application/json"),{offsetX:o,offsetY:r}=i?JSON.parse(i):{offsetX:0,offsetY:0};if(!t)return;let S=this.sceneService.chibisOnScene.find(Y=>Y.id===t)??this.catalogService.getChibis().find(Y=>Y.id===t);if(!S)return;this.sceneService.chibisOnScene.includes(S)||this.sceneService.addChibi(S);let E=e.currentTarget.getBoundingClientRect(),ae=e.clientX-E.left-o,ce=e.clientY-E.top-r;this.sceneService.setChibiPosition(S,ae,ce)}static \u0275fac=function(t){return new(t||n)(m(f),m(w))};static \u0275cmp=c({type:n,selectors:[["app-scene-board"]],decls:2,vars:1,consts:[[1,"scene-board",3,"dragover","drop"],["class","scene-chibi",3,"chibi","left","top",4,"ngFor","ngForOf"],[1,"scene-chibi",3,"chibi"]],template:function(t,i){t&1&&(a(0,"div",0),u("dragover",function(r){return i.onDragOver(r)})("drop",function(r){return i.onDrop(r)}),M(1,pe,1,5,"scene-chibi-item",1),s()),t&2&&(l(),d("ngForOf",i.sceneService.chibisOnScene))},dependencies:[R,D,N],styles:['@charset "UTF-8";.scene-board[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;margin:0;padding:0;background-color:#000}.scene-chibi[_ngcontent-%COMP%]{position:absolute;font-size:clamp(2rem,5vw,6rem);cursor:grab;-webkit-user-select:none;user-select:none;pointer-events:auto;touch-action:none;transition:left .1s,top .1s}']})};var A=class n{constructor(e,t){this.sceneService=e;this.router=t}gotoHome(){this.router.navigate(["/"])}static \u0275fac=function(t){return new(t||n)(m(f),m(te))};static \u0275cmp=c({type:n,selectors:[["app-start-pause-controls"]],decls:9,vars:0,consts:[[1,"controls"],["title","Accueil",1,"shake-element",3,"click"],["src","assets/images/home.jpg"],["title","D\xE9marrer",1,"shake-element",3,"click"],["src","assets/images/start.png"],["title","Pause",1,"shake-element",3,"click"],["src","assets/images/pause.png"],["title","Effacer",1,"shake-element",3,"click"],["src","assets/images/clear.png"]],template:function(t,i){t&1&&(h(0,"div",0)(1,"button",1),_("click",function(){return i.gotoHome()}),C(2,"img",2),b(),h(3,"button",3),_("click",function(){return i.sceneService.startScene()}),C(4,"img",4),b(),h(5,"button",5),_("click",function(){return i.sceneService.pauseScene()}),C(6,"img",6),b(),h(7,"button",7),_("click",function(){return i.sceneService.clearScene()}),C(8,"img",8),b()())},styles:[".controls[_ngcontent-%COMP%]{position:absolute;top:10px;right:calc(100vw - 360px);display:flex;gap:10px;background-color:transparent}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0;font-size:1rem;cursor:pointer;background-color:transparent;border:0}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{padding:0;font-size:1rem;cursor:pointer;width:80px;background-color:transparent}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]:hover{transform:scale(1.2)}"]})};var B=class n{chibi;isDisabled=!1;dragStart=new $;onDragStart(e){if(console.log("Drag started for chibi:",this.chibi),this.isDisabled){e.preventDefault();return}e.stopPropagation();let i=e.target.getBoundingClientRect(),o=e.clientX-i.left,r=e.clientY-i.top;e.dataTransfer?.setData("text/plain",this.chibi.id),e.dataTransfer?.setData("application/json",JSON.stringify({offsetX:o,offsetY:r})),this.dragStart.emit(this.chibi),console.log("DataTransfer set for chibi:",this.chibi.id,{offsetX:o,offsetY:r})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=c({type:n,selectors:[["app-chibi-item"]],inputs:{chibi:"chibi",isDisabled:"isDisabled"},outputs:{dragStart:"dragStart"},decls:4,vars:7,consts:[["draggable","true",1,"chibi",3,"dragstart"],[1,"chibi-img",3,"src","alt"],[1,"chibi-name"]],template:function(t,i){t&1&&(h(0,"div",0),_("dragstart",function(r){return i.onDragStart(r)}),C(1,"img",1),h(2,"span",2),p(3),b()()),t&2&&(j("disabled",i.isDisabled),l(),Q("src",i.chibi.imageUrl,F)("alt",i.chibi.nom),l(),x("color",i.chibi.couleur),l(),q(" ",i.chibi.nom," "))},styles:['@charset "UTF-8";.chibi[_ngcontent-%COMP%]{height:100%;aspect-ratio:1/1;display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:2rem;border-radius:8px;cursor:grab;flex:0 0 auto;font-size:4rem;background-color:transparent}.chibi.disabled[_ngcontent-%COMP%]{opacity:.4;pointer-events:none;cursor:not-allowed;filter:grayscale(80%)}.chibi-name[_ngcontent-%COMP%]{font-weight:700;font-family:Arial,sans-serif;font-size:1rem;text-transform:capitalize}.chibi-img[_ngcontent-%COMP%]{padding:0;margin:0;width:80%;height:80%;object-fit:contain}']})};var V=class n{constructor(e){this.platformId=e}ngAfterViewInit(){if(ee(this.platformId))try{(window.adsbygoogle=window.adsbygoogle||[]).push({})}catch(e){console.error("AdSense error:",e)}}static \u0275fac=function(t){return new(t||n)(m(X))};static \u0275cmp=c({type:n,selectors:[["app-adsense"]],decls:4,vars:0,consts:[[1,"ad-wrapper"],[1,"ad-label"],["data-ad-client","ca-pub-7139204610189883","data-ad-slot","TON_SLOT_ID",1,"adsbygoogle",2,"display","inline-block","width","250px","height","300px"]],template:function(t,i){t&1&&(h(0,"div",0)(1,"span",1),p(2,"Sponsoris\xE9"),b(),C(3,"ins",2),b())},styles:['@charset "UTF-8";.ad-wrapper[_ngcontent-%COMP%]{padding:0;margin:0;display:flex;flex-direction:column;align-items:center;justify-content:center;width:250px;height:100%;border:0px dashed #ddd;background-color:#fdfdfd;border-radius:12px}.ad-label[_ngcontent-%COMP%]{font-size:10px;color:#aaa;text-transform:uppercase;margin-bottom:5px}']})};var de=["catalog"];function ge(n,e){if(n&1&&(a(0,"div",4),g(1,"app-chibi-item",7),s()),n&2){let t=e.$implicit,i=y();l(),d("chibi",t)("isDisabled",i.isChibiDisabled(t))}}var U=class n{constructor(e,t){this.catalogService=e;this.sceneService=t}chibis=[];catalogRef;ngOnInit(){this.chibis=this.catalogService.getChibis()}scrollRight(){this.catalogRef.nativeElement.scrollBy({left:150,behavior:"smooth"})}scrollLeft(){this.catalogRef.nativeElement.scrollBy({left:-150,behavior:"smooth"})}isChibiDisabled(e){return this.sceneService.chibisOnScene.some(t=>t.id===e.id)}static \u0275fac=function(t){return new(t||n)(m(w),m(f))};static \u0275cmp=c({type:n,selectors:[["app-catalog-list"]],viewQuery:function(t,i){if(t&1&&J(de,5),t&2){let o;G(o=K())&&(i.catalogRef=o.first)}},decls:10,vars:1,consts:[["catalog",""],[1,"catalog-wrapper"],["draggable","false",1,"scroll-btn","left",3,"click"],[1,"catalog"],[1,"chibi-wrapper"],["class","chibi-wrapper",4,"ngFor","ngForOf"],["draggable","false",1,"scroll-btn","right",3,"click"],["draggable","true",3,"chibi","isDisabled"]],template:function(t,i){if(t&1){let o=k();a(0,"div",1)(1,"button",2),u("click",function(){return P(o),O(i.scrollLeft())}),p(2,"\u25C0"),s(),a(3,"div",3,0)(5,"div",4),g(6,"app-adsense"),s(),M(7,ge,2,2,"div",5),s(),a(8,"button",6),u("click",function(){return P(o),O(i.scrollRight())}),p(9,"\u25B6"),s()()}t&2&&(l(7),d("ngForOf",i.chibis))},dependencies:[D,N,B,V],styles:[".catalog-wrapper[_ngcontent-%COMP%]{position:relative;height:100%}.catalog[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;gap:10px;padding:0;height:100%;overflow-x:auto;background-color:transparent}.catalog[_ngcontent-%COMP%]   .chibi-wrapper[_ngcontent-%COMP%]{flex:0 0 auto}.scroll-btn[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);width:30px;height:100px;background:#0000004d;color:#fff;border:none;cursor:pointer;font-size:1.5rem;z-index:10;border-radius:4px;-webkit-user-drag:none;-webkit-user-select:none;user-select:none}.scroll-btn.left[_ngcontent-%COMP%]{left:0}.scroll-btn.right[_ngcontent-%COMP%]{right:0}"]})};var se=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=c({type:n,selectors:[["app-scene-page"]],decls:5,vars:0,consts:[[1,"scene-container"],[1,"catalog-container"]],template:function(t,i){t&1&&(a(0,"div",0),g(1,"app-scene-board")(2,"app-start-pause-controls"),s(),a(3,"div",1),g(4,"app-catalog-list"),s())},dependencies:[z,A,U],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100vh;margin:0;padding:0}.scene-container[_ngcontent-%COMP%]{flex:1;position:relative;background-color:transparent;overflow:hidden;margin:0;padding:0}.catalog-container[_ngcontent-%COMP%]{height:15vh;background-color:#000}"]})};export{se as ScenePageComponent};
