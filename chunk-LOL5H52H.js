import{b as W}from"./chunk-B3LNQQ6I.js";import{$a as j,Ca as l,Ga as y,La as p,Ma as s,Na as c,O as T,Oa as h,Pa as f,Qa as P,Ra as O,S as A,Sa as w,Ta as X,Ua as d,Va as M,Wa as C,Xa as $,Y as S,Ya as Q,Z as _,Za as J,_a as D,ab as b,cb as G,hb as K,pa as F,qa as a,ua as H,vb as L,wb as q,xb as x,ya as m}from"./chunk-65XOUCD6.js";var g=class n{constructor(e){this.strudelService=e}chibisOnScene=[];draggedChibi;isPlaying=!1;chibiPositions=new Map;addChibi(e){this.chibisOnScene.includes(e)||(e.delay=Math.random()*-.5,this.chibisOnScene.push(e),this.isPlaying&&this.playChibis())}removeChibi(e){this.chibisOnScene=this.chibisOnScene.filter(t=>t.id!=e.id),this.isPlaying&&this.playChibis()}clearScene(){this.chibisOnScene=[],this.strudelService.stop(),this.isPlaying=!1}startScene(){this.strudelService.initialized||this.strudelService.initialize(),this.isPlaying=!0,this.playChibis()}pauseScene(){this.isPlaying=!1,this.strudelService.stop()}getCombinedCode(){if(this.chibisOnScene.length===0)return"";let e=this.chibisOnScene.filter(t=>!t.isMuted).map(t=>t.code);return console.log("Combined codes:",e),`stack(${e.join(",")})`}setChibiPosition(e,t,i){this.chibiPositions.set(e.id,{x:t,y:i})}getChibiPosition(e){return this.chibiPositions.get(e.id)||{x:0,y:0}}muteChibi(e){e.isMuted=!0,this.playChibis()}unmuteChibi(e){e.isMuted=!1,this.playChibis()}playChibis(){let e=this.getCombinedCode();console.log("Playing combined code:",e),e&&this.strudelService.play(e)}static \u0275fac=function(t){return new(t||n)(A(W))};static \u0275prov=T({token:n,factory:n.\u0275fac,providedIn:"root"})};function re(n,e){if(n&1){let t=w();s(0,"div",5),d("click",function(o){S(t);let r=C();return _(r.muteChibi(o))}),b(1," \u{1F507} "),c()}}function se(n,e){if(n&1){let t=w();s(0,"div",6),d("click",function(o){S(t);let r=C();return _(r.unmuteChibi(o))}),b(1," \u{1F50A} "),c()}}var R=class n{constructor(e){this.sceneService=e}chibi=null;onDragStart(e,t){let i=e.target,o=i.cloneNode(!0),r=i.getBoundingClientRect(),u=e.clientX-r.left,k=e.clientY-r.top;e.dataTransfer?.setData("text/plain",t.id),e.dataTransfer?.setData("application/json",JSON.stringify({offsetX:u,offsetY:k})),o.style.width=`${r.width}px`,o.style.height=`${r.height}px`,o.style.position="fixed",o.style.top="-1000px",o.style.left="-1000px",o.style.zIndex="1000",o.style.opacity="1",o.style.pointerEvents="none",document.body.appendChild(o),e.dataTransfer?.setDragImage(o,u,k),setTimeout(()=>{document.body.removeChild(o)},0),console.log("Drag started (MOVE) for chibi:",t)}removeChibi(e){e.stopPropagation(),this.sceneService.removeChibi(this.chibi)}muteChibi(e){this.sceneService.muteChibi(this.chibi)}unmuteChibi(e){this.sceneService.unmuteChibi(this.chibi)}static \u0275fac=function(t){return new(t||n)(m(g))};static \u0275cmp=l({type:n,selectors:[["scene-chibi-item"]],inputs:{chibi:"chibi"},decls:6,vars:10,consts:[["draggable","true",1,"scene-chibi","shake-element",3,"dragstart"],["title","Retirer le chibi",1,"remove-btn",3,"click"],["class","mute-btn","title","Faire taire le chibi",3,"click",4,"ngIf"],["class","mute-btn","title","Faire jouer le chibi",3,"click",4,"ngIf"],[1,"chibi-img",3,"src"],["title","Faire taire le chibi",1,"mute-btn",3,"click"],["title","Faire jouer le chibi",1,"mute-btn",3,"click"]],template:function(t,i){t&1&&(s(0,"div",0),d("dragstart",function(r){return i.onDragStart(r,i.chibi)}),s(1,"div",1),d("click",function(r){return i.removeChibi(r)}),b(2," \u2716 "),c(),y(3,re,2,0,"div",2)(4,se,2,0,"div",3),h(5,"img",4),c()),t&2&&(D("animation-delay",i.chibi.delay+"s"),j("is-playing",i.sceneService.isPlaying)("is-muted",i.chibi.isMuted),a(3),p("ngIf",!i.chibi.isMuted),a(),p("ngIf",i.chibi.isMuted),a(),p("src",K(i.chibi==null?null:i.chibi.imageUrl),F))},dependencies:[x,q],styles:['@charset "UTF-8";.scene-chibi[_ngcontent-%COMP%]{position:absolute;width:8%;height:auto;font-size:4rem;cursor:grab;display:flex;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_chibi-bounce 1s ease-in-out infinite;animation-play-state:paused}.scene-chibi[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%], .scene-chibi[_ngcontent-%COMP%]   .mute-btn[_ngcontent-%COMP%]{position:absolute;width:22px;height:22px;border-radius:50%;background:#000c;color:#fff;font-size:12px;line-height:22px;text-align:center;cursor:pointer;border:1px solid rgba(255,255,255,.2);opacity:0;pointer-events:none;transition:all .15s ease}.scene-chibi[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]:hover, .scene-chibi[_ngcontent-%COMP%]   .mute-btn[_ngcontent-%COMP%]:hover{transform:scale(1.2);background:#000}.scene-chibi[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]{top:-8px;right:-8px;color:#ff4d4d}.scene-chibi[_ngcontent-%COMP%]   .mute-btn[_ngcontent-%COMP%]{top:20px;right:-8px;font-size:14px}.scene-chibi[_ngcontent-%COMP%]:hover   .remove-btn[_ngcontent-%COMP%], .scene-chibi[_ngcontent-%COMP%]:hover   .mute-btn[_ngcontent-%COMP%]{opacity:1;pointer-events:auto}@media (hover: none){.scene-chibi[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%], .scene-chibi[_ngcontent-%COMP%]   .mute-btn[_ngcontent-%COMP%]{opacity:1;pointer-events:auto}}.chibi-img[_ngcontent-%COMP%]{padding:0;margin:0;width:15vw!important;height:15vh!important;object-fit:contain}@keyframes _ngcontent-%COMP%_chibi-bounce{0%,to{transform:translateY(0)}50%{transform:translateY(-20px)}}.scene-chibi.is-playing[_ngcontent-%COMP%]{animation-play-state:running}.scene-chibi.is-muted[_ngcontent-%COMP%]{animation-play-state:paused!important;filter:grayscale(100%) brightness(.8)}']})};var ee=[{id:"s1",slug:"Akane",nom:"Akane",emoji:"\u{1F9B6}",couleur:"#FF0000",code:'s("bd:0 ~ bd:0 [bd:0 bd:0]")',category:"kick",imageUrl:"assets/images/chibis/tambour.png"},{id:"s2",slug:"Chika",nom:"Chika",emoji:"\u{1F4A5}",couleur:"#FFD700",code:'s("[~ hh:0] [~ hh:0] [~ hh:0] ~")',category:"hat",imageUrl:"assets/images/chibis/highhat.png"},{id:"s3",slug:"Riku",nom:"Riku",emoji:"\u{1F40D}",couleur:"#32CD32",code:'s("~ sn:1 ~ [~ ~ ho:1 ~ ]")',category:"snare",imageUrl:"assets/images/chibis/snare.png"},{id:"s4",slug:"Kira",nom:"Kira",emoji:"\u{1F9E8}",couleur:"#FF4500",code:'s("~ ~ ~ [~ cr:5]")',category:"perc",imageUrl:"assets/images/chibis/cymballe.png"},{id:"s5",slug:"Sumire",nom:"Sumire",emoji:"\u{1F32B}\uFE0F",couleur:"#4B0082",code:'note("<[0 ~ ~ ~] [0 ~ [~ 4] [~ 7]] 8*4 5*4>").scale("D:minor").sound("arpy:0").lpf(200).release(0.1)',category:"bass",imageUrl:"assets/images/chibis/basse.png"},{id:"s6",slug:"Nana",nom:"Nana",emoji:"\u{1F3B8}",couleur:"#1E90FF",code:'note("<[e1 c1 ~ ~ e1 e1 ~ ~] [e1 c1 ~ ~ e1 g1 ~ ~] [a1 e1 ~ ~ a1 a1 ~ ~] [f1 a1 ~ ~ f1 a1 ~ ~]>").scale("D:minor").sound("arpy:0").sustain(2).decay(10).delay(".05").room(0.5)',category:"guitare",imageUrl:"assets/images/chibis/guitare.png"},{id:"s7",slug:"Rei",nom:"Rei",emoji:"\u2728",couleur:"#FF00FF",code:'note("[~ ~ g4 b4 ~ a4 g4 ~ ~ e4 g4 ~ b4 a4 g4 e4]/4").sound("arpy:0").clip(0.3).room(1).gain("0.7 0.9 0.6 0.8")',category:"lead",imageUrl:"assets/images/chibis/clavier.png"}];var I=class n{getChibis(){return ee}static \u0275fac=function(t){return new(t||n)};static \u0275prov=T({token:n,factory:n.\u0275fac,providedIn:"root"})};function ce(n,e){if(n&1&&h(0,"scene-chibi-item",2),n&2){let t=e.$implicit,i=C();D("left",i.sceneService.getChibiPosition(t).x,"px")("top",i.sceneService.getChibiPosition(t).y,"px"),p("chibi",t)}}var z=class n{constructor(e,t){this.sceneService=e;this.catalogService=t}chibis=[];ngOnInit(){}onDragOver(e){e.preventDefault()}onDrop(e){e.preventDefault();let t=e.dataTransfer?.getData("text/plain"),i=e.dataTransfer?.getData("application/json"),{offsetX:o,offsetY:r}=i?JSON.parse(i):{offsetX:0,offsetY:0};if(!t)return;let u=this.sceneService.chibisOnScene.find(Y=>Y.id===t)??this.catalogService.getChibis().find(Y=>Y.id===t);if(!u)return;this.sceneService.chibisOnScene.includes(u)||this.sceneService.addChibi(u);let k=e.currentTarget.getBoundingClientRect(),ne=e.clientX-k.left-o,oe=e.clientY-k.top-r;this.sceneService.setChibiPosition(u,ne,oe)}static \u0275fac=function(t){return new(t||n)(m(g),m(I))};static \u0275cmp=l({type:n,selectors:[["app-scene-board"]],decls:2,vars:1,consts:[[1,"scene-board",3,"dragover","drop"],["class","scene-chibi",3,"chibi","left","top",4,"ngFor","ngForOf"],[1,"scene-chibi",3,"chibi"]],template:function(t,i){t&1&&(s(0,"div",0),d("dragover",function(r){return i.onDragOver(r)})("drop",function(r){return i.onDrop(r)}),y(1,ce,1,5,"scene-chibi-item",1),c()),t&2&&(a(),p("ngForOf",i.sceneService.chibisOnScene))},dependencies:[R,x,L],styles:['@charset "UTF-8";.scene-board[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;margin:0;padding:0;background-color:#000}.scene-chibi[_ngcontent-%COMP%]{position:absolute;font-size:clamp(2rem,5vw,6rem);cursor:grab;-webkit-user-select:none;user-select:none;pointer-events:auto;touch-action:none;transition:left .1s,top .1s}']})};var B=class n{constructor(e){this.sceneService=e}static \u0275fac=function(t){return new(t||n)(m(g))};static \u0275cmp=l({type:n,selectors:[["app-start-pause-controls"]],decls:7,vars:0,consts:[[1,"controls"],[1,"shake-element",3,"click"],["src","assets/images/start.png"],["src","assets/images/pause.png"],["src","assets/images/clear.png"]],template:function(t,i){t&1&&(f(0,"div",0)(1,"button",1),M("click",function(){return i.sceneService.startScene()}),O(2,"img",2),P(),f(3,"button",1),M("click",function(){return i.sceneService.pauseScene()}),O(4,"img",3),P(),f(5,"button",1),M("click",function(){return i.sceneService.clearScene()}),O(6,"img",4),P()())},styles:[".controls[_ngcontent-%COMP%]{position:absolute;top:10px;right:calc(100vw - 270px);display:flex;gap:10px;background-color:transparent}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0;font-size:1rem;cursor:pointer;background-color:transparent;border:0}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{padding:0;font-size:1rem;cursor:pointer;width:80px;background-color:transparent}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]:hover{transform:scale(1.2)}"]})};var U=class n{chibi;isDisabled=!1;dragStart=new H;onDragStart(e){if(console.log("Drag started for chibi:",this.chibi),this.isDisabled){e.preventDefault();return}e.stopPropagation();let i=e.target.getBoundingClientRect(),o=e.clientX-i.left,r=e.clientY-i.top;e.dataTransfer?.setData("text/plain",this.chibi.id),e.dataTransfer?.setData("application/json",JSON.stringify({offsetX:o,offsetY:r})),this.dragStart.emit(this.chibi),console.log("DataTransfer set for chibi:",this.chibi.id,{offsetX:o,offsetY:r})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=l({type:n,selectors:[["app-chibi-item"]],inputs:{chibi:"chibi",isDisabled:"isDisabled"},outputs:{dragStart:"dragStart"},decls:4,vars:7,consts:[["draggable","true",1,"chibi",3,"dragstart"],[1,"chibi-img",3,"src","alt"],[1,"chibi-name"]],template:function(t,i){t&1&&(f(0,"div",0),M("dragstart",function(r){return i.onDragStart(r)}),O(1,"img",1),f(2,"span",2),b(3),P()()),t&2&&(j("disabled",i.isDisabled),a(),X("src",i.chibi.imageUrl,F)("alt",i.chibi.nom),a(),D("color",i.chibi.couleur),a(),G(" ",i.chibi.nom," "))},styles:['@charset "UTF-8";.chibi[_ngcontent-%COMP%]{height:100%;aspect-ratio:1/1;display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:2rem;border-radius:8px;cursor:grab;flex:0 0 auto;font-size:4rem;background-color:transparent}.chibi.disabled[_ngcontent-%COMP%]{opacity:.4;pointer-events:none;cursor:not-allowed;filter:grayscale(80%)}.chibi-name[_ngcontent-%COMP%]{font-weight:700;font-family:Arial,sans-serif;font-size:1rem;text-transform:capitalize}.chibi-img[_ngcontent-%COMP%]{padding:0;margin:0;width:80%;height:80%;object-fit:contain}']})};var ae=["catalog"];function le(n,e){if(n&1&&(s(0,"div",6),h(1,"app-chibi-item",7),c()),n&2){let t=e.$implicit,i=C();a(),p("chibi",t)("isDisabled",i.isChibiDisabled(t))}}var V=class n{constructor(e,t){this.catalogService=e;this.sceneService=t}chibis=[];catalogRef;ngOnInit(){this.chibis=this.catalogService.getChibis()}scrollRight(){this.catalogRef.nativeElement.scrollBy({left:150,behavior:"smooth"})}scrollLeft(){this.catalogRef.nativeElement.scrollBy({left:-150,behavior:"smooth"})}isChibiDisabled(e){return this.sceneService.chibisOnScene.some(t=>t.id===e.id)}static \u0275fac=function(t){return new(t||n)(m(I),m(g))};static \u0275cmp=l({type:n,selectors:[["app-catalog-list"]],viewQuery:function(t,i){if(t&1&&$(ae,5),t&2){let o;Q(o=J())&&(i.catalogRef=o.first)}},decls:8,vars:1,consts:[["catalog",""],[1,"catalog-wrapper"],["draggable","false",1,"scroll-btn","left",3,"click"],[1,"catalog"],["class","chibi-wrapper",4,"ngFor","ngForOf"],["draggable","false",1,"scroll-btn","right",3,"click"],[1,"chibi-wrapper"],["draggable","true",3,"chibi","isDisabled"]],template:function(t,i){if(t&1){let o=w();s(0,"div",1)(1,"button",2),d("click",function(){return S(o),_(i.scrollLeft())}),b(2,"\u25C0"),c(),s(3,"div",3,0),y(5,le,2,2,"div",4),c(),s(6,"button",5),d("click",function(){return S(o),_(i.scrollRight())}),b(7,"\u25B6"),c()()}t&2&&(a(5),p("ngForOf",i.chibis))},dependencies:[x,L,U],styles:[".catalog-wrapper[_ngcontent-%COMP%]{position:relative;height:100%}.catalog[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;gap:10px;padding:0;height:100%;overflow-x:auto;background-color:transparent}.catalog[_ngcontent-%COMP%]   .chibi-wrapper[_ngcontent-%COMP%]{flex:0 0 auto}.scroll-btn[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);width:30px;height:100px;background:#0000004d;color:#fff;border:none;cursor:pointer;font-size:1.5rem;z-index:10;border-radius:4px;-webkit-user-drag:none;-webkit-user-select:none;user-select:none}.scroll-btn.left[_ngcontent-%COMP%]{left:0}.scroll-btn.right[_ngcontent-%COMP%]{right:0}"]})};var ie=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=l({type:n,selectors:[["app-scene-page"]],decls:5,vars:0,consts:[[1,"scene-container"],[1,"catalog-container"]],template:function(t,i){t&1&&(s(0,"div",0),h(1,"app-scene-board")(2,"app-start-pause-controls"),c(),s(3,"div",1),h(4,"app-catalog-list"),c())},dependencies:[z,B,V],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100vh;margin:0;padding:0}.scene-container[_ngcontent-%COMP%]{flex:1;position:relative;background-color:transparent;overflow:hidden;margin:0;padding:0}.catalog-container[_ngcontent-%COMP%]{height:15vh;background-color:#000}"]})};export{ie as ScenePageComponent};
